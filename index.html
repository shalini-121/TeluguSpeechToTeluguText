<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞Æ‡∞æ‡∞ü‡∞≤‡±Å - ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞™‡∞¶‡∞æ‡∞≤‡±Å</title>
    <link rel="stylesheet" href="Tstyle.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu&display=swap" rel="stylesheet">
</head>
<body>
    <div class="overlay"></div>
    <div class="container">
        <h1>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞Æ‡∞æ‡∞ü‡∞≤‡±Å - ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞™‡∞¶‡∞æ‡∞≤‡±Å</h1>
        <p class="subtitle">‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞ø, ‡∞Ü ‡∞§‡∞∞‡±ç‡∞µ‡∞æ‡∞§ ‡∞´‡∞≤‡∞ø‡∞§‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø</p>

        <div class="btn-container">
            <button id="toggle-btn">‚ñ∂ ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å</button>
            <button id="copy-btn" style="display:none;">üìã ‡∞ï‡∞æ‡∞™‡±Ä</button>
            <div class="loading-spinner" id="spinner"></div>
        </div>

        <div id="speech-output">‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞ø‡∞® ‡∞™‡∞¶‡∞æ‡∞≤‡±Å ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø...</div>
    </div>

    <script>
        const toggleBtn = document.getElementById('toggle-btn');
        const copyBtn = document.getElementById('copy-btn');
        const output = document.getElementById('speech-output');
        const spinner = document.getElementById('spinner');

        let recognizing = false;
        let finalTranscript = ""; // store confirmed results

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (!SpeechRecognition) {
            alert("‡∞Æ‡±Ä ‡∞¨‡±ç‡∞∞‡±å‡∞ú‡∞∞‡±ç ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞ø‡∞® ‡∞™‡∞¶‡∞æ‡∞≤‡∞®‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞≤‡±á‡∞¶‡±Å. Chrome ‡∞¨‡±ç‡∞∞‡±å‡∞ú‡∞∞‡±ç ‡∞µ‡∞æ‡∞°‡∞Ç‡∞°‡∞ø.");
        }

        const recog = new SpeechRecognition();
        recog.lang = "te-IN";
        recog.continuous = true;
        recog.interimResults = true;

        // Toggle Start/Stop
        toggleBtn.onclick = function() {
            if (recognizing) {
                recog.stop();
            } else {
                output.innerText = "";
                finalTranscript = "";
                recog.start();
            }
        };

        recog.onstart = () => {
            recognizing = true;
            toggleBtn.innerText = "‚ñ† ‡∞Ü‡∞™‡±Å";
            spinner.style.display = "block";
            output.style.color = "#777";
            output.innerText = "‡∞µ‡∞ø‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø... ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞Ç‡∞°‡∞ø.";
        };

        recog.onend = () => {
            recognizing = false;
            toggleBtn.innerText = "‚ñ∂ ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞ø‡∞Ç‡∞ö‡±Å";
            spinner.style.display = "none";
            if (output.innerText.trim() === "" || output.innerText.includes("‡∞µ‡∞ø‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±ã‡∞Ç‡∞¶‡∞ø")) {
                output.innerText = "‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞ø‡∞® ‡∞™‡∞¶‡∞æ‡∞≤‡±Å ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø...";
            }
        };

        // ‚úÖ Fixed onresult (no duplicate text)
        recog.onresult = (e) => {
            let interimTranscript = "";
            for (let i = e.resultIndex; i < e.results.length; ++i) {
                let transcript = e.results[i][0].transcript;
                if (e.results[i].isFinal) {
                    finalTranscript += transcript + " ";
                } else {
                    interimTranscript += transcript;
                }
            }

            // Show both final + interim
            output.innerText = finalTranscript + interimTranscript;

            // Style interim as gray, final as black
            output.style.color = interimTranscript ? "#777" : "#000";

            // Show copy button only if we have final text
            if (finalTranscript.trim() !== "") {
                copyBtn.style.display = "inline-block";
            }
        };

        // Copy to clipboard
        copyBtn.onclick = () => {
            navigator.clipboard.writeText(finalTranscript.trim());
            alert("‡∞™‡∞¶‡∞æ‡∞≤‡±Å ‡∞ï‡∞æ‡∞™‡±Ä ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞æ‡∞Ø‡∞ø!");
        };

        // Optional: Spacebar shortcut
        document.onkeyup = (e) => {
            if (e.code === 'Space') {
                toggleBtn.click();
            }
        };
    </script>
</body>
</html>

